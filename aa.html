<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modern Cars</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#000;
  --white:#fff;
  --muted: rgba(255,255,255,0.72);
  --radius:14px;
  --success: #25D366;
  --error: #ff6b6b;
}
*{box-sizing:border-box; margin:0; padding:0;}
html,body{height:100%; font-family:Inter, system-ui, sans-serif; color:var(--white); background:var(--bg); overflow:hidden;}
body{display:flex; flex-direction:column; justify-content:space-between;}
canvas{position:fixed; inset:0; z-index:0;}
.wrap{position:relative; z-index:2; max-width:980px; margin:0 auto; padding:40px 16px; display:flex; flex-direction:column; align-items:center; gap:24px;}
.logo img{width:64px; height:64px; border-radius:12px; object-fit:cover;}
.hero{text-align:center;}
.hero .h1{font-size:34px; font-weight:800; background: linear-gradient(90deg, #fff, rgba(255,255,255,0.9)); -webkit-background-clip:text; color:transparent;}
.hero .short{margin-top:6px; color:var(--muted); font-size:14px;}
.cta-card{background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); border-radius:14px; padding:20px; min-width:280px; display:flex; flex-direction:column; gap:12px; backdrop-filter: blur(6px);}
.cta-title{font-weight:800; font-size:15px; text-align:center;}
form{display:flex; flex-direction:column; gap:10px;}
input{padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:white;}
#submitBtn{margin-top:10px; padding:12px; border-radius:12px; font-weight:800; color:white; background:linear-gradient(90deg, rgba(37,211,102,0.13), rgba(255,255,255,0.01)); border:1px solid rgba(37,211,102,0.16); cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; transition: all 0.3s ease;}
#submitBtn:disabled{opacity:0.6; cursor:not-allowed;}
.pulse{width:12px; height:12px; border-radius:50%; background:#25D366; animation:pulse 1.6s infinite;}
@keyframes pulse{0%{transform:scale(0.86);opacity:0.95}70%{transform:scale(1.45);opacity:0.5}100%{transform:scale(0.86);opacity:0.95}}
footer{color:var(--muted); text-align:center; padding:12px; font-size:13px; z-index:2;}
.success-msg{color:var(--success);}
.error-msg{color:var(--error);}
</style>
</head>
<body>
<canvas id="bg-canvas" aria-hidden="true"></canvas>
<div class="wrap">
  <div class="logo"><img src="logo.jpeg" alt="Modern Cars"></div>
  <div class="hero">
    <h1 class="h1">Modern Cars</h1>
    <div class="short">Русификация на все виды китайских автомобилей</div>
  </div>
  <aside class="cta-card">
    <div class="cta-title">Қосылыңыз</div>
    <form id="leadForm">
      <input id="name" name="name" type="text" placeholder="Есіміңіз" required maxlength="80">
      <input id="phone" name="phone" type="tel" placeholder="+7 (___) ___-__-__" required>
      <button type="submit" id="submitBtn"><span class="pulse"></span> Жіберу</button>
      <div id="formMsg" style="font-size:13px;display:none;text-align:center;margin-top:6px;"></div>
    </form>
  </aside>
</div>
<footer>© 2025 Modern Cars - все права защищены</footer>

<script>
// Google Apps Script Web App URL
const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbx-6hS8kBdywv2c4h0Y-8DN1wiiX4ZDrh5i8cdb2Ld7-F5ZOe7AalguFuuD6OEVt0DO/exec";

const form = document.getElementById('leadForm');
const submitBtn = document.getElementById('submitBtn');
const msgEl = document.getElementById('formMsg');

// Телефон нөміріне автоформаттау
const phoneInput = document.getElementById('phone');
phoneInput.addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  
  // Егер +7 енгізілген болса, оны алып тастау
  if (value.startsWith('7')) {
    value = value.substring(1);
  }
  
  let formattedValue = '+7 ';
  if (value.length > 0) formattedValue += '(' + value.substring(0, 3);
  if (value.length > 3) formattedValue += ') ' + value.substring(3, 6);
  if (value.length > 6) formattedValue += '-' + value.substring(6, 8);
  if (value.length > 8) formattedValue += '-' + value.substring(8, 10);
  
  e.target.value = formattedValue;
});

// Форманы жіберу
form.addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const name = document.getElementById('name').value.trim();
  const phoneRaw = document.getElementById('phone').value.trim();
  const phoneDigits = phoneRaw.replace(/\D/g, '');
  
  // Хабарламаны тазарту
  msgEl.style.display = 'none';
  msgEl.className = '';
  
  // Валидация
  if (!name) {
    showMessage('Есімді енгізіңіз', 'error');
    return;
  }
  
  if (phoneDigits.length !== 11 || !phoneDigits.startsWith('7')) {
    showMessage('Телефон нөмірі дұрыс емес', 'error');
    return;
  }

  // Телефон нөмірін халықаралық форматтау
  const phone = '+7' + phoneDigits.substring(1);
  
  // Жіберу түймесін өшіру
  setSubmitButtonState(true, 'Жіберілуде...');
  
  try {
    console.log('Деректер жіберілуде:', { name, phone });
    
    // XMLHttpRequest қолдану (fetch орнына)
    const xhr = new XMLHttpRequest();
    xhr.open('POST', GAS_WEB_APP_URL);
    xhr.setRequestHeader('Content-Type', 'application/json');
    
    // Кепілдікпен жауап күту
    const result = await new Promise((resolve, reject) => {
      xhr.onload = function() {
        if (xhr.status === 200) {
          try {
            const result = JSON.parse(xhr.responseText);
            resolve(result);
          } catch (e) {
            reject(new Error('Жауапты өңдеу қатесі'));
          }
        } else {
          reject(new Error(`Сервер қатесі: ${xhr.status}`));
        }
      };
      
      xhr.onerror = function() {
        reject(new Error('Желі қатесі'));
      };
      
      xhr.ontimeout = function() {
        reject(new Error('Уақыт асып кетті'));
      };
      
      xhr.timeout = 10000; // 10 секунд
      xhr.send(JSON.stringify({name: name, phone: phone}));
    });
    
    console.log('Жауап алынды:', result);
    
    if (result.status === 'success') {
      showMessage('Сіздің сұрауыңыз сәтті жіберілді!', 'success');
      setSubmitButtonState(true, '✅ Жіберілді');
      form.reset();
      
      // 3 секундтан кейін түймені қалпына келтіру
      setTimeout(() => {
        setSubmitButtonState(false, '<span class="pulse"></span> Жіберу');
        msgEl.style.display = 'none';
      }, 3000);
    } else {
      throw new Error(result.message || 'Белгісіз қате');
    }
  } catch(err) {
    console.error('Қате детальдары:', err);
    
    // Нақты қате хабарламасы
    let errorMessage = 'Деректер жіберілмеді. ';
    
    if (err.message.includes('Желі қатесі') || err.message.includes('Уақыт асып кетті')) {
      errorMessage += 'Интернет байланысын тексеріңіз немесе кейінірек қайталаңыз.';
    } else {
      errorMessage += err.message || 'Жүйелік қате орын алды.';
    }
    
    showMessage(errorMessage, 'error');
    setSubmitButtonState(false, '<span class="pulse"></span> Жіберу');
  }
});

// Хабарламаны көрсету функциясы
function showMessage(message, type) {
  msgEl.textContent = message;
  msgEl.className = type + '-msg';
  msgEl.style.display = 'block';
}

// Түйме күйін орнату функциясы
function setSubmitButtonState(disabled, html) {
  submitBtn.disabled = disabled;
  submitBtn.innerHTML = html;
}

// Canvas particles effect
(function(){
  const canvas=document.getElementById('bg-canvas');
  const ctx=canvas.getContext('2d');
  let w=canvas.width=innerWidth;
  let h=canvas.height=innerHeight;
  const particles=[];
  const mouse={x:-9999,y:-9999};
  for(let i=0;i<150;i++){
    particles.push({x:Math.random()*w, y:Math.random()*h, r:Math.random()*6+2, vx:(Math.random()-0.5)*0.5, vy:(Math.random()-0.5)*0.5});
  }
  window.addEventListener('resize',()=>{w=canvas.width=innerWidth; h=canvas.height=innerHeight;});
  window.addEventListener('mousemove',e=>{mouse.x=e.clientX; mouse.y=e.clientY;});
  function loop(){
    ctx.clearRect(0,0,w,h);
    for(const p of particles){
      p.x += p.vx; p.y += p.vy;
      const dx=p.x-mouse.x; const dy=p.y-mouse.y; const dist=Math.sqrt(dx*dx+dy*dy);
      if(dist<100){p.x+=(dx/dist)*2; p.y+=(dy/dist)*2;}
      if(p.x<0)p.x=w; if(p.x>w)p.x=0; if(p.y<0)p.y=h; if(p.y>h)p.y=0;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle='rgba(255,255,255,0.8)'; ctx.fill();
    }
    requestAnimationFrame(loop);
  }
  loop();
})();
</script>
</body>
</html>